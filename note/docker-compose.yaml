services:
  # 1. MongoDB ëŒ€ì‹  Elasticsearch ì„œë¹„ìŠ¤ ì¶”ê°€
  elasticsearch:
    image: elasticsearch:8.14.0 # ì•ˆì •ì ì¸ ìµœì‹  ë²„ì „ ì‚¬ìš© ê¶Œì¥
    container_name: note-elasticsearch
    ports:
      - "9200:9200" # ì™¸ë¶€(ë¡œì»¬ í˜¸ìŠ¤íŠ¸)ì—ì„œ 9200 í¬íŠ¸ë¡œ ì ‘ê·¼ ê°€ëŠ¥
    environment:
      # ë¡œì»¬ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ë‹¨ì¼ ë…¸ë“œ ì„¤ì •
      - discovery.type=single-node
      # ë©”ëª¨ë¦¬ ì„¤ì •ì„ í†µí•´ ì•ˆì •í™” (ìµœì†Œ 2GB ë©”ëª¨ë¦¬ í• ë‹¹ ê¶Œì¥)
      - ES_JAVA_OPTS=-Xms512m -Xmx512m
      # Elasticsearch 8.x ë²„ì „ì„ ìœ„í•´ ë³´ì•ˆ(X-Pack)ì„ ì¼ì‹œì ìœ¼ë¡œ ë¹„í™œì„±í™”í•©ë‹ˆë‹¤.
      - xpack.security.enabled=false
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:9200 || exit 1"]
      interval: 10s
      timeout: 5s
      retries: 5

  # 2. ìŠ¤í”„ë§ ë¶€íŠ¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë¹„ìŠ¤
  note:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: note-app
    # platform: linux/amd64
    ports:
      - "8083:8080"
    environment:
      # ğŸš¨ MongoDB URI ëŒ€ì‹  Elasticsearch URI ì‚¬ìš©
      # Docker Compose ë‚´ë¶€ì—ì„œëŠ” ì„œë¹„ìŠ¤ ì´ë¦„ 'elasticsearch'ë¥¼ í˜¸ìŠ¤íŠ¸ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.
      SPRING_ELASTICSEARCH_URIS: http://elasticsearch:9200
    depends_on:
      elasticsearch:
        condition: service_healthy
